let e,t,n=[],a=0,o=!0,i=0,l=[],d=0,s=[20,11,18,7,1,14,6,19,17,2,13,4,15,8,12,16],r=[],c=[],u=!1,m=!1,p=!1,g=!1,f=!1,k=!1,b=!1,y=!1,C=[];const j=document.getElementById("playerInputForm"),x=document.getElementById("inputName"),h=document.getElementById("deskripcija"),E=document.getElementById("listOfPlayers"),v=document.getElementById("addPlayer"),B=document.getElementById("startButton"),I=document.getElementById("back"),L=document.getElementById("revealRole"),M=document.getElementById("player"),$=document.getElementById("roleHolder"),w=document.getElementById("warning"),S=document.getElementById("settingsButton"),P=document.getElementById("cardHolder"),N=document.getElementById("displayName"),z=document.getElementById("displayAlignment"),T=document.getElementById("displayDesc"),R=document.getElementById("playerHolder"),D=document.getElementById("cancelManager"),U=document.getElementById("cancel"),A=document.getElementById("nightButton"),K=document.getElementById("wakeUpRole"),Z=document.getElementById("infoRole"),H=document.getElementById("action"),O=document.getElementById("backToManager"),V=document.getElementById("secondAction"),J=document.getElementById("meta"),F=document.getElementById("mainMenu"),X=document.getElementById("roleSelection"),q=document.getElementById("settingsMenu"),G=document.getElementById("managerMenu"),Q=document.getElementById("playerInfoMenu"),W=document.getElementById("nightMenu"),Y="#4B4B4B",_="#8f3636ff",ee="#944fa0ff",te="#4CAF50",ne="#f9f9f9",ae="#000000ff",oe=["one.png","two.png","three.png","four.png","five.png","six.png"],ie="resourses/plates/";import{roles as le}from"./data.js";function de(e){x.disabled=e,v.disabled=e}function se(e){N.textContent=`Uloga: ${le[e].role}`,z.textContent=`Strana: ${le[e].alignment}`,T.textContent=le[e].description,J.textContent=10==e?`Meta egzekucije: ${t}`:""}function re(){B.textContent=`${l.length} \\ ${n.length}`}function ce(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}function ue(e,t){const n=e.indexOf(t);return e.splice(n,1),e}function me(e,n){Z.innerHTML="";const a=document.createElement("h3");a.textContent=n;const o=document.createElement("h3");o.textContent=le[l[e]].role;const i=document.createElement("p");i.textContent=`Strana: ${le[l[e]].alignment}`;const d=document.createElement("p");d.textContent=le[l[e]].description;let s=[a,o,i,d];if(10==l[e]){let e=document.createElement("p");e.textContent=`Meta egzekucije: ${t}`,s.push(e)}Z.append(...s)}let pe;function ge(){console.log("pozvan wakeup"),d>r.length?Le(W,G,"grid"):d===r.length?(function(){for(var e of(C=[],R.children))if(Ie(e,"ubij")&&Ie(e,"zastitiZivotom")&&!Ie(e,"zastiti"))for(var t of R.children)"13"===t.dataset.role&&(Be(t,"alive","dead"),C.push(t.dataset.name));else Ie(e,"ubij")&&!Ie(e,"zastiti")?(Be(e,"alive","dead"),C.push(e.dataset.name)):1==y&&Ie(e,"polij")&&Ie(e,"alive")&&(Be(e,"alive","dead"),ve(e,"polij"),C.push(e.dataset.name))}(),0==C.length?K.textContent="Jutro je, niko nije ubijen":(C.length,K.textContent=fe(C),ke(C[C.length-1])),d+=1,H.textContent="Nazad",function(t){for(let n of R.children)console.log(n.dataset.name+"je posetio"+n.dataset.visited),t==n.dataset.role&&(n.disabled=!1,n.style.backgroundColor=ne),ve(n,"ubij"),ve(n,"zastiti"),ve(n,"blokiraj"),ve(n,"kontrolisi"),ve(n,"target"),ve(n,"zastitiZivotom"),ve(n,"mafijaNapada"),ve(n,"kogaPosetio"),e=null,Ie(n,"dead")&&(n.disabled=!0,n.style.backgroundColor=Y);delete H.dataset.purpose}(pe)):(pe=r[d],H.disabled=!1,H.style.display="block",V.style.display="none",V.textContent="Sledeći",!function(e){for(let t of R.children)if(Ie(t,"blokiraj")&&t.dataset.role==e)return!0;return!1}(pe)?!function(e){let t=!1;for(let n of R.children)if(n.dataset.role==e){if(!Ie(n,"dead"))return!1;t=!0}return t}(pe)?"12"==pe?(V.style.display="block",V.textContent="Zapali sve",K.textContent=`Budi se ${le[pe].role}`):(K.textContent=`Budi se ${le[pe].role}`,V.textContent="Sledeći"):(K.textContent=`MRTAV Budi se ${le[pe].role} MRTAV`,H.style.display="none",V.style.display="block",V.textContent="Sledeći"):(K.textContent=`BLOKIRAN Budi se ${le[pe].role} \n BLOKIRAN`,H.style.display="none",V.style.display="block",V.textContent="Sledeći"),he(),d+=1)}function fe(e){if(0===e.length)return"";if(1===e.length)return"Jutro je, ubijen je "+e[0];if(2===e.length)return"Jutro je, ubijeni su "+e[0]+" i "+e[1];let t=[];for(let n of e)t.push(e[n]);return"Jutro je, ubijeni su "+t.slice(0,-1).join(", ")+" i "+t[t.length-1]}function ke(e){let t=[...R.children].find(t=>t.dataset.name===e);t&&(R.dataset.mortitianTarget=`${t.dataset.name} ${le[t.dataset.role].role}`)}function be(e,t){if(e){console.log("role igraca "+e+" je "),console.log("role igraca koji akcija je "+t+" "+le[H.dataset.id].role),console.log("-------------------------------");for(let n of R.children)n.dataset.role===t&&(n.dataset.visited=e)}}function ye(e){switch(Le(W,G,"grid"),e){case"actionPickPlayer":u=!0;break;case"actionShowRole":m=!0;break;case"actionDousePlayer":p=!0;break;case"actionControlPlayer":g=!0;break;case"actionPickTarget":f=!0,g=!1;break;case"actionSeVisited":k=!0;break;case"actionRemember":b=!0}for(let t of R.children){if(H.dataset.id==t.dataset.role&&(t.disabled=!0,t.style.backgroundColor=ae),"actionDousePlayer"===e&&Ie(t,"polij")&&!Ie(t,"dead")&&(t.disabled=!0,t.style.backgroundColor="#636819ff"),Ie(t,"kontrolisi")&&H.dataset.id==t.dataset.role){console.log("sad kontrolisani");for(let e of R.children)Ie(e,"target")||(e.disabled=!0,e.style.backgroundColor=ae)}Ie(t,"kontrolisi")&&11==H.dataset.id&&(t.style.backgroundColor="#f1327bff",t.disabled=!0),Ie(t,"alive")&&20==H.dataset.id&&(t.disabled=!0,t.style.backgroundColor=ae),Ie(t,"dead")&&20==H.dataset.id&&(t.disabled=!1,t.style.backgroundColor=ne)}}function Ce(e){Le(G,W,"block"),b=!1;for(let t of R.children)20==t.dataset.role&&(t.disabled=!1,t.style.backgroundColor=ne,t.dataset.role=e);console.log(l),console.log(r),H.disabled=!0,K.textContent="Tvoja nova uloga je "+le[e].role+" ti si na strani "+le[e].alignment}function je(e){Le(W,G,"grid"),Le(G,W,"block"),K.textContent=null==e||null==e?e.dataset.name+" nije nikog posetio ove noći.":e.dataset.name+` je posetio ${e.dataset.visited} ove noći`,H.textContent="Sledeći",H.dataset.purpose="wakeUpNext",k=!1}function xe(e){Le(e,W,"block"),u=!1,m=!1,p=!1;for(let e of R.children)if(Ie(e,"polij")&&!Ie(e,"dead")&&(e.style.backgroundColor=ne,e.disabled=!1),!Ie(e,"kontrolisi"))for(let e of R.children)Ie(e,"target")||Ie(e,"dead")||(e.style.backgroundColor=ne,e.disabled=!1);g?(d-=1,g=!1,f=!0,console.log(g,f),he()):ge()}function he(){const e=r[d];switch(console.log(r),console.log("id uloge"+e),e){case 1:case 6:case 14:H.textContent="Istraži",H.dataset.purpose="istrazi";break;case 2:H.textContent="Zaštiti",H.dataset.purpose="zastiti";break;case 4:case 8:H.textContent="Ubij",H.dataset.purpose="ubij";break;case 7:case 18:H.textContent="Blokiraj",H.dataset.purpose="blokiraj";break;case 11:f?(H.dataset.purpose="target",H.textContent="Na koga"):(H.textContent="Kontroliši",H.dataset.purpose="kontrolisi");break;case 12:H.textContent="Polij",H.dataset.purpose="polij";break;case 13:H.textContent="Zaštiti životom",H.dataset.purpose="zastitiZivotom";break;case 15:H.textContent="Koga mafija napada",H.dataset.purpose="mafijaNapada";break;case 16:H.textContent="Koga je posetio",H.dataset.purpose="kogaPosetio";break;case 19:H.textContent="Istraži",H.dataset.purpose="najskorijeUbijen";break;case 20:{let e=!1;for(let t of R.children)if(Ie(t,"dead")){e=!0;break}e?(console.log("seti se"),H.textContent="Seti se",H.dataset.purpose="setiSe",V.style.display="block",V.textContent="Preskoči"):(console.log("sledeci"),H.textContent="Budi sledećeg",H.dataset.purpose="wakeUpNext");break}default:H.textContent="Budi sledećeg",H.dataset.purpose="nista"}H.dataset.id=e}function Ee(e,t){let n=e.dataset.status?e.dataset.status.split(" "):[];n.includes(t)||(n.push(t),e.dataset.status=n.join(" "))}function ve(e,t){let n=e.dataset.status?e.dataset.status.split(" "):[];n=n.filter(e=>e!==t),e.dataset.status=n.join(" ")}function Be(e,t,n){let a=e.dataset.status?e.dataset.status.split(" "):[];a=a.map(e=>e===t?n:e),e.dataset.status=a.join(" ")}function Ie(e,t){return(e.dataset.status?e.dataset.status.split(" "):[]).includes(t)}function Le(e,t,n){e.style.display="none",t.style.display=n}j.addEventListener("submit",function(e){e.preventDefault();const t=x.value.trim();""!==t?function(e){if(n.includes(e))return void function(e){alert("Igrač "+e+" je već dodat u igru, molimo Vas koristite drugo ime!"),x.value=""}(e);!function(e){0===n.length&&(h.style.display="none");const t=document.createElement("li");t.textContent=e,t.style.backgroundImage=`url('${function(){const e=Math.floor(Math.random()*oe.length);return ie+oe[e]}()}')`;const a=document.createElement("button");a.innerText="X",a.id="deleteButton",a.addEventListener("click",()=>{const e=t.firstChild.textContent.trim();!function(e,t){e.parentElement.remove(),n=n.filter(e=>e!==t),de(!1)}(a,e),0===n.length&&(h.style.display="block")}),t.appendChild(a),E.appendChild(t),n.push(e),x.value="",20==n.length&&de(!0)}(e)}(t):window.alert("Molimo unesite ime igrača!")}),B.addEventListener("click",function(e){if(e.preventDefault(),0!=i)window.alert(`Potrebno je dodati još ${i} uloga`);else{if(X.style.display="flex",q.style.display="none",l.includes("10")){let e=l.filter(e=>"10"!==e);t=n[e[Math.floor(Math.random()*e.length)]]}ce(n),ce(l),a=0,M.textContent=n[a],se(l[a]),function(){for(let e in n)e={name:n[e],alive:!0,role:l[e],statuses:[]},c.append(this)}()}}),S.addEventListener("click",function(e){e.preventDefault(),function(){P.innerHTML="";for(const e in le){const t=e,a=document.createElement("div");a.classList.add("card");const o=document.createElement("h3");o.textContent=le[e].role,o.classList.add("roleName");const d=document.createElement("p");d.textContent=`Strana: ${le[e].alignment}`,d.classList.add("roleAlignment");const s=document.createElement("p");s.textContent=`Tip: ${le[e].category}`,s.classList.add("roleCategory");const r=document.createElement("p");r.textContent=le[e].description,r.classList.add("roleDescription");const c=document.createElement("div");c.classList.add("numberDiv");const u=document.createElement("button");u.classList.add("addRole");const m=document.createElement("p");m.textContent=0,m.classList.add("counter");const p=document.createElement("button");p.classList.add("removeRole"),i=n.length-l.length,u.addEventListener("click",()=>{let e=parseInt(m.textContent);e<n.length&&i>0?(m.textContent=e+1,i-=1,l.push(t),re()):window.alert("Dodavanjem ove uloge bilo bi više uloga nego igrača!")}),p.addEventListener("click",()=>{let e=parseInt(m.textContent);e>0&&(m.textContent=e-1,i+=1,l.includes(t)&&ue(l,t),re())}),"Selo"===le[e].alignment?a.style.backgroundColor=te:"Mafija"===le[e].alignment?a.style.background=_:"Neutralno"===le[e].alignment&&(a.style.backgroundColor=ee),20==e||11==e?c.textContent="Bice dodato":c.append(p,m,u),a.append(o,d,s,r,c),P.appendChild(a)}}(),re(),Le(F,q,"grid")}),I.addEventListener("click",function(e){e.preventDefault(),Le(X,F,"flex"),w.textContent="Kliknite na dugme da sakrijete svoju ulogu i predajte telefon igraču koji je sledeći naveden",w.style.display="none",l=[]}),L.addEventListener("click",function(){o?(w.style.display="flex",$.style.display="block",se(l[a]),a===n.length-1?w.textContent="Kliknite na dugme da sakrijete svoju ulogu i predajte uređaj naratoru":w.textContent="Kliknite na dugme da sakrijete svoju ulogu i predajte uređaj sledećem igraču."):(Le(w,$,"none"),a===n.length-1?(Le(X,G,"grid"),function(){R.innerHTML="";for(let t in n){const a=document.createElement("button");a.classList.add("card"),a.classList.add("infoCard"),a.dataset.status="alive",a.dataset.role=`${l[t]}`,a.dataset.id=t,a.dataset.name=n[t];const o=document.createElement("h3");o.textContent=le[l[t]].role,a.addEventListener("click",()=>{u?(Ee(a,H.dataset.purpose),be(a.dataset.name,H.dataset.id),xe(G),4!=H.dataset.id&&5!=H.dataset.id&&6!=H.dataset.id&&7!=H.dataset.id||(console.log(H.dataset.id),e=a.dataset.name)):p?(Ee(a,H.dataset.purpose),be(a.dataset.name,H.dataset.id),xe(G),V.style.display="none"):m?(Le(G,Q,"block"),be(a.dataset.name,H.dataset.id),me(a.dataset.id,o.textContent)):g?(Ee(a,H.dataset.purpose),be(a.dataset.name,H.dataset.id),xe(G),f=!0):f?(Ee(a,H.dataset.purpose),xe(G)):k?je(a):b?Ce(a.dataset.role):(Le(G,Q,"block"),me(a.dataset.id,o.textContent));for(let e of R.children)Ie(e,"alive")&&(e.disabled=!1,e.style.backgroundColor=ne),Ie(e,"dead")&&(e.disabled=!0,e.style.backgroundColor=ae)}),a.append(o),a.classList.add("playerStats"),R.append(a)}}()):(a+=1,M.textContent=n[a])),o=!o}),U.addEventListener("click",()=>{Le(q,F,"flex"),l=[]}),D.addEventListener("click",()=>{Le(G,F,"flex"),l=[]}),A.addEventListener("click",()=>{d=0,Le(G,W,"block"),r=[...new Set(l.map(Number))].filter(e=>s.includes(e)).sort((e,t)=>s.indexOf(e)-s.indexOf(t)),ge()}),O.addEventListener("click",()=>{m?xe(Q):Le(Q,G,"grid")}),V.addEventListener("click",()=>{if("polij"===H.dataset.purpose)y=!0;ge()}),H.addEventListener("click",()=>{switch(W.style.display="none",H.dataset.purpose){case"istrazi":ye("actionShowRole");break;case"zastiti":case"ubij":case"blokiraj":case"zastitiZivotom":ye("actionPickPlayer");break;case"kontrolisi":ye("actionControlPlayer");break;case"polij":ye("actionDousePlayer");break;case"kogaPosetio":ye("actionSeVisited");break;case"mafijaNapada":!function(){Le(W,G,"grid"),Le(G,W,"block"),K.textContent=null==e||null==e?"Mafija nikog ne napada ove noći.":`Mafija ćе ove noći napasti ${e}`;H.textContent="Sledeći",H.dataset.purpose="wakeUpNext"}();break;case"wakeUpNext":ge(),Le(W,G,"grid"),Le(G,W,"block");break;case"najskorijeUbijen":!function(){if(Le(W,G,"grid"),Le(G,W,"block"),R.dataset.mortitianTarget){let[e,t]=R.dataset.mortitianTarget.split(" ");K.textContent=`Poslednji ubijen igrač ${e} je bio ${t}`}else K.textContent="Nema mrtvih!";console.log("mortitian"),H.textContent="Sledeći",H.dataset.purpose="wakeUpNext"}();break;case"setiSe":ye("actionRemember");break;case"target":ye("actionPickTarget");break;default:ge()}});